<!doctype html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">


</head>
<body>
  <canvas id="canvas"></canvas>

  <script>
    //  ctrl altGr 5
		//https://idiallo.com/blog/javascript-syntax-highlighter
    "use strict";

let canvas = document.getElementById("canvas");
let gl = canvas.getContext("webgl");

gl.getExtension("OES_texture_float");
gl.getExtension("OES_texture_float_linear");

gl.canvas.width = 4;
gl.canvas.height = 3;
gl.canvas.style.width="90px";



let vertex = `
  attribute vec2 a_position;
  attribute vec2 a_texCoord;


  varying vec2 v_texCoord;


  void main() {


    gl_Position=vec4(a_position,0,1);
    v_texCoord = a_position;

  }
    `;

let fragment = `
      precision mediump float;
      uniform sampler2D u_image;
      varying vec2 v_texCoord;
      void main() {


       gl_FragColor = vec4(v_texCoord,333,999);

      }
    `;

let shader = gl.createProgram();
const vertexShader = gl.createShader(gl.VERTEX_SHADER);
const fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);
gl.shaderSource(vertexShader, vertex);
gl.shaderSource(fragmentShader, fragment);
gl.compileShader(vertexShader);
gl.compileShader(fragmentShader);
gl.attachShader(shader, vertexShader);
gl.attachShader(shader, fragmentShader);
gl.linkProgram(shader);
  gl.useProgram(shader);




  let positionLocation = gl.getAttribLocation(shader, "a_position");
  let texcoordLocation = gl.getAttribLocation(shader, "a_texCoord");

  let positionBuffer = gl.createBuffer();
  gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);


    gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([
    -1, -1,
    -1, 1,
    1, -1,
    1, -1,
    -1, 1,
    1, 1
  ]), gl.STATIC_DRAW);



  gl.viewport(0, 0, gl.canvas.width, gl.canvas.height);



  gl.enableVertexAttribArray(positionLocation);
  gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);
  let size = 2;
  let type = gl.FLOAT;
  let normalize = false;
  let stride = 0;
  let offset = 0;
  gl.vertexAttribPointer(positionLocation, size, type, normalize, stride, offset);









  let textureEcran = gl.createTexture();

      gl.bindTexture(gl.TEXTURE_2D, textureEcran);
      gl.texImage2D(
        gl.TEXTURE_2D,
        0,             
        gl.RGBA,
        canvas.width,
        canvas.height,
        0,
        gl.RGBA,
        gl.FLOAT,
        null);
      //gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);
      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);
      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);
      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);
      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);



      
      let fbEcran = gl.createFramebuffer();
      gl.bindFramebuffer(gl.FRAMEBUFFER,fbEcran);
      gl.framebufferTexture2D(
        gl.FRAMEBUFFER,
        gl.COLOR_ATTACHMENT0,
        gl.TEXTURE_2D,
        textureEcran,
        0
      );

  gl.drawArrays(gl.TRIANGLES, 0, 6);



let ff= new Float32Array(
	 gl.canvas.width  *
	 gl.canvas.height * 
	 4
);
gl.readPixels(0,0,gl.canvas.width , gl.canvas.height,gl.RGBA,gl.FLOAT,ff);
console.log(ff);




	</script>

</body>
</html>


  
