<!doctype html>
<html>
  <body>
  	<canvas id="canvas">
  	</canvas>
    <script>
      let canvas = document.getElementById("canvas");

      canvas.style.imageRendering="pixelated";
      canvas.style.backgroundColor="rgb(0,255,0)"


      //Set display size (CSS pixels)
      let size = 3;
      canvas.style.width = `${size}px`;
      canvas.style.height = `${size}px`;


      //set actual size in memory (scaled to account for extra pixel density)
      const scale = window.devicePixelRatio;


      canvas.width = size * scale ;
      canvas.height = size * scale ;

      let gl = canvas.getContext("webgl");


      
      gl.getExtension("OES_texture_float");
      gl.getExtension("OES_texture_float_linear");
      
      gl.viewport(0, 0, gl.canvas.width, gl.canvas.height);

      let vs=`
      attribute vec2 aPosition;

      void main() {
        vec2 pixelCoord = vec2(1.0,1.0);
        pixelCoord = aPosition;



        gl_Position = vec4(
          (pixelCoord.x + 0.5)/ ${canvas.width}.0 * 2.0 -1.0,
          (pixelCoord.y + 0.5)/ ${canvas.height}.0 * 2.0 -1.0,
          0,1);



        gl_PointSize = 1.0;
      }
      `;
      let fs=`
      precision mediump float;

      void main() {
        gl_FragColor = vec4(gl_FragCoord.xy,0,1);
        gl_FragColor = vec4(1,0,0,1);
      }
      `;

      const vertexShader = gl.createShader(gl.VERTEX_SHADER);
      gl.shaderSource(vertexShader,vs);
      gl.compileShader(vertexShader);

      const fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);
      gl.shaderSource(fragmentShader,fs);
      gl.compileShader(fragmentShader);

      const program = gl.createProgram();
      gl.attachShader(program,vertexShader);
      gl.attachShader(program,fragmentShader);
      gl.linkProgram(program);
      gl.useProgram(program);

      let positionBuffer = gl.createBuffer();
      gl.bindBuffer(gl.ARRAY_BUFFER,positionBuffer);
      gl.bufferData(
        gl.ARRAY_BUFFER,
        new Float32Array([
          0,3,
          1,1,
          2,2,
          3,3]),
        gl.STATIC_DRAW
      );
      let positionAttributeLocation = gl.getAttribLocation(program, "aPosition");
      
      // turn the attribute "on"
      gl.enableVertexAttribArray(positionAttributeLocation);

      {
        // Tell the attribute how to get data out of positionBuffer (ARRAY_BUFFER)
        let size = 2;          // 2 components per iteration
        let type = gl.FLOAT;   // the data is 32bit floats
        let normalize = false; // don't normalize the data
        let stride = 0;        // 0 = move forward size * sizeof(type) each iteration to get the next position
        let offset = 0;        // start at the beginning of the buffer
        gl.vertexAttribPointer(
          positionAttributeLocation, size, type, normalize, stride, offset);
      }

      let textureEcran = gl.createTexture();
      gl.bindTexture(gl.TEXTURE_2D, textureEcran);
      gl.texImage2D(
        gl.TEXTURE_2D,
        0,                // mip level
        gl.RGBA,          // internal format
        canvas.width,   // width
        canvas.height,  // height
        0,                // border
        gl.RGBA,          // format
        gl.FLOAT, // type
        null,             // data
      );
      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);

      /*
      let fbEcran = gl.createFramebuffer();
      gl.bindFramebuffer(gl.FRAMEBUFFER,fbEcran);
      gl.framebufferTexture2D(
        gl.FRAMEBUFFER,
        gl.COLOR_ATTACHMENT0,
        gl.TEXTURE_2D,
        textureEcran,
        0
      );
     */


      gl.drawArrays(gl.POINTS, 0, 4);

      let pixels = new Float32Array(canvas.width*canvas.height*4);
      gl.readPixels(0,0,canvas.width,canvas.height,gl.RGBA,gl.FLOAT,pixels);
      console.log(pixels);

  /*
  
  0000        0000 0000 0000 0000 0000
  1.5 1.5 0 1 0000 0000 0000 
  32..55 : 0
  2.5 2.5 0 1
  60..71 : 0
  0.5 3.5 0 1

x           x x x x x
1.5 1.5 0 1 x x x x x
x   x   x x x x x x x
x   
  

  0: 0
1: 0
2: 0
3: 0
4: 0
5: 0
6: 0
7: 0
8: 0
9: 0
10: 0
11: 0
12: 0
13: 0
​​
14: 0
​​
15: 0
​​
16: 0
​​
17: 0
​​
18: 0
​​
19: 0
​​
20: 0
​​
21: 0
​​
22: 0
​​
23: 0
​​
24: 0
​​
25: 0
​​
26: 0
​​
27: 0
​​
28: 1.5
​​
29: 1.5
​​
30: 0
​​
31: 1
​​
32: 0
​​
33: 0
​​
34: 0
​​
35: 0
​​
36: 0
​​
37: 0
​​
38: 0
​​
39: 0
​​
40: 0
​​
41: 0
​​
42: 0
​​
43: 0
​​
44: 0
​​
45: 0
​​
46: 0
​​
47: 0
​​
48: 0
​​
49: 0
​​
50: 0
​​
51: 0
​​
52: 0
​​
53: 0
​​
54: 0
​​
55: 0
​​
56: 2.5
​​
57: 2.5
​​
58: 0
​​
59: 1
​​
60: 0
​​
61: 0
​​
62: 0
​​
63: 0
​​
64: 0
​​
65: 0
​​
66: 0
​​
67: 0
​​
68: 0
​​
69: 0
​​
70: 0
​​
71: 0
​​
72: 0.5
​​
73: 3.5
​​
74: 0
​​
75: 1
​​
76: 0
​​
77: 0
​​
78: 0
​​
79: 0
​​
80: 0
​​
81: 0
​​
82: 0
​​
83: 0
​​
84: 3.5
​​
85: 3.5
​​
86: 0
​​
87: 1
​​
88: 0
​​
89: 0
​​
90: 0
​​
91: 0
​​
92: 0
​​
93: 0
​​
94: 0
​​
95: 0
​​
96: 0
​​
97: 0
​​
98: 0
​​
99: 0
  */

/*
0:  0   0   0  0  pix1
4:  0   0   0  0  pix2
8:  0   0   0  0  pix3
12: 0   0   0  0  pix4
16: 0   0   0  0  pix5
20: 0   0   0  0  pix6
24: 0   0   0  0  pix7
28: 1,5 1,5 0  1  pix8
32: 0   0   0  0
...
140:0   0   0  0


5  pix31  ........................pix36
4  pix25  ....    ...
3  pix19  ....     ......
2  pix13  ....  ... ....
1  pix7  [pix8]                   pix12
0  pix1   ...   ....              pix6
   0      1     2     3     4     5   

*/

    </script>
  </body>
</html>

